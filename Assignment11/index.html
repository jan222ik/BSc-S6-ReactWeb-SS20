<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <title>Title</title>
</head>
<style> /* set the CSS */

.bar { fill: steelblue; }

</style>
<body>
<script>
    (function chartCountryActive() {
        // set the dimensions and margins of the graph
        const margin = {top: 20, right: 40, bottom: 30, left: 40},
            width = 960 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;

        // set the ranges
        const x = d3.scaleBand()
            .range([0, width])
            .padding(0.1);
        const y = d3.scaleLinear()
            .range([height, 0]);

        // append the svg object to the body of the page
        // append a 'group' element to 'svg'
        // moves the 'group' element to the top left margin
        const svg = d3.select("body").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        const calcActive = (country) => country.TotalConfirmed - (country.TotalDeaths + country.TotalRecovered)

        // get the data
        d3.json("https://api.covid19api.com/summary", function(error, data) {
            if (error) throw error;

            data.Countries.forEach(value => value.Cases = calcActive(value))
            data.Countries.sort((a, b) => b.Cases - a.Cases)

            const chartData = data.Countries.slice(0, 10)



            console.dir(chartData)

            // Scale
            x.domain(chartData.map(it => it.Country));
            y.domain([0, d3.max(chartData, it => it.Cases)]);

            // Append Rects
            svg.selectAll(".bar")
                .data(chartData)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", it => x(it.Country))
                .attr("width", x.bandwidth())
                .attr("y", it => y(it.Cases))
                .attr("height", it => height - y(it.Cases));

            // add the x Axis
            svg.append("g")
                .attr("transform", "translate(0," + (height + 5) + ")")
                .call(d3.axisBottom(x));
        });
    })();

</script>
<script>

    (function chartAustriaActive() {
        // set the dimensions and margins of the graph
        const margin = {top: 20, right: 40, bottom: 30, left: 40},
            width = 960 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;


        // Append svg
        const svg = d3.select("body").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        // get the data
        d3.json("https://api.covid19api.com/live/country/austria/status/confirmed/date/2020-02-01T00:00:00Z", function(error, data) {
            if (error) throw error;
            console.dir(data)

            function parseTime(d){
                const dateString = d.Date.toLocaleString('us').split('T')[0];
                console.log(dateString)
                return { date : d3.timeParse("%Y-%m-%d")(dateString), value : d.Active }
            }

            data = data.map(it => parseTime(it))
            console.dir(data)

            var x = d3.scaleTime()
                .domain(d3.extent(data, it => it.date))
                .range([ 0, width ]);
            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x));

            var y = d3.scaleLinear()
                .domain([0, d3.max(data, function(d) { return +d.value; })])
                .range([ height, 0 ]);
            svg.append("g")
                .call(d3.axisLeft(y));

            // Append Line
            svg.append("path")
                .datum(data)
                .attr("fill", "none")
                .attr("stroke", "steelblue")
                .attr("stroke-width", 1.5)
                .attr("d", d3.line()
                    .x(function(d) { return x(d.date) })
                    .y(function(d) { return y(d.value) })
                )

        });
    })();
</script>
</body>
